(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1638:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(7021)}])},7021:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>V});var n=s(2510),a=s(1646);let r=e=>{let{className:t="",size:s=16,children:a,...r}=e;return(0,n.jsx)("span",{className:"inline-block ".concat(t),style:{width:s,height:s,fontSize:s-2},...r,children:a})},l=e=>(0,n.jsx)(r,{...e,children:"\uD83E\uDD16"}),c=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDC64"}),o=e=>(0,n.jsx)(r,{...e,children:"⏳"}),i=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCE4"}),d=e=>(0,n.jsx)(r,{...e,children:"⚠️"}),u=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCCA"}),m=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDD04"}),h=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDD17"}),x=e=>(0,n.jsx)(r,{...e,children:"☁️"}),g=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCC1"}),f=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCC2"}),p=e=>(0,n.jsx)(r,{...e,children:"▶️"}),y=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDD3D"}),b=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCF6"}),j=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCE1"}),N=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCF5"}),v=e=>(0,n.jsx)(r,{...e,children:"⚠️"}),w=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDDD1️"}),S=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCC4"}),D=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCDD"}),R=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDDBC️"}),C=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCBB"}),E=e=>(0,n.jsx)(r,{...e,children:"\uD83D\uDCE6"}),k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;try{return e.toLocaleString("en-US",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"})}catch(e){return new Date().toISOString()}};var T=s(8678);let I={BASE_URL:"https://rag-render.onrender.com",TIMEOUTS:{HEALTH_CHECK:15e3,SYNC:3e5,QUERY:4e4,LIST_FILES:2e4,DEBUG:1e4},RETRY:{MAX_ATTEMPTS:3,DELAY_MS:2e3,BACKOFF_MULTIPLIER:2},POLLING:{SYNC_STATUS:3e3,DEBUG_INFO:5e3,CONNECTION:3e4}},O="v2.2.0-Enhanced-Reliability";T.env.NEXT_PUBLIC_GOOGLE_DRIVE_FOLDER_ID;class P{async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=new AbortController,r=setTimeout(()=>a.abort(),s),l=++this.requestCount,c={...t,signal:a.signal,headers:{"Content-Type":"application/json","X-Request-ID":l.toString(),...t.headers}};for(let t=1;t<=n;t++){let a=Date.now();try{console.log("\uD83D\uDD04 API Request #".concat(l," (attempt ").concat(t,"/").concat(n,"): ").concat(e));let s=await fetch("".concat(this.baseUrl).concat(e),c);clearTimeout(r);let o=Date.now()-a;if(!s.ok){let e=await s.json().catch(()=>({})),a=e.detail||e.message||"HTTP ".concat(s.status);if(s.status>=500&&t<n){console.log("\uD83D\uDD04 Server error ".concat(s.status,", retrying...")),await this.delay(this.getRetryDelay(t));continue}throw Error(a)}let i=await s.json();return this.successCount++,this.updateResponseTime(o),console.log("✅ API Success #".concat(l," (attempt ").concat(t,"): ").concat(e," (").concat(o,"ms)")),i}catch(a){if(clearTimeout(r),"AbortError"===a.name){if(console.log("⏰ API Timeout #".concat(l," (attempt ").concat(t,"): ").concat(e)),t===n)throw this.errorCount++,Error("Request timed out after ".concat(s/1e3," seconds"))}else if(a.message.includes("message channel closed")){if(console.warn("Async response channel closed (likely extension interference):",a),t===n)throw this.errorCount++,Error("Network channel closed unexpectedly")}else if(console.log("❌ API Error #".concat(l," (attempt ").concat(t,"): ").concat(e," - ").concat(a.message)),t===n)throw this.errorCount++,a;t<n&&await this.delay(this.getRetryDelay(t))}}}getRetryDelay(e){return I.RETRY.DELAY_MS*Math.pow(I.RETRY.BACKOFF_MULTIPLIER,e-1)}delay(e){return new Promise(t=>setTimeout(t,e))}updateResponseTime(e){this.avgResponseTime=(this.avgResponseTime*(this.successCount-1)+e)/this.successCount}getMetrics(){return{totalRequests:this.requestCount,successCount:this.successCount,errorCount:this.errorCount,successRate:this.requestCount>0?(this.successCount/this.requestCount*100).toFixed(1):0,avgResponseTime:Math.round(this.avgResponseTime)}}async healthCheck(){return this.makeRequest("/health",{},I.TIMEOUTS.HEALTH_CHECK,2)}async syncDrive(){return this.makeRequest("/sync_drive",{method:"POST"},I.TIMEOUTS.SYNC,2)}async listFiles(){return this.makeRequest("/list_files",{},I.TIMEOUTS.LIST_FILES,3)}async listIndexedFiles(){return this.makeRequest("/list_indexed_files",{},I.TIMEOUTS.LIST_FILES,3)}async askQuestion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.makeRequest("/ask",{method:"POST",body:JSON.stringify({query:e,filters:t})},I.TIMEOUTS.QUERY,2)}async getSyncStatus(){return this.makeRequest("/sync_status",{},I.TIMEOUTS.DEBUG,1)}async getDebugInfo(){return this.makeRequest("/debug_live",{},I.TIMEOUTS.DEBUG,1)}async submitFeedback(e){return this.makeRequest("/feedback",{method:"POST",body:JSON.stringify(e)},1e4,1)}async emergencyReset(){return this.makeRequest("/emergency_reset",{method:"POST"},15e3,1)}async testGoogleDriveAccess(){return this.makeRequest("/debug",{},1e4,1)}constructor(e){this.baseUrl=e,this.requestCount=0,this.errorCount=0,this.successCount=0,this.avgResponseTime=0}}let _=new P(I.BASE_URL),A=()=>(0,n.jsx)("div",{className:"w-8 h-8 flex items-center justify-center",children:(0,n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",className:"w-8 h-8",children:[(0,n.jsxs)("defs",{children:[(0,n.jsxs)("radialGradient",{id:"outerGrad",cx:"30%",cy:"30%",children:[(0,n.jsx)("stop",{offset:"0%",stopColor:"#FDE047"}),(0,n.jsx)("stop",{offset:"100%",stopColor:"#F97316"})]}),(0,n.jsxs)("radialGradient",{id:"innerGrad",cx:"30%",cy:"30%",children:[(0,n.jsx)("stop",{offset:"0%",stopColor:"#FEF3C7"}),(0,n.jsx)("stop",{offset:"100%",stopColor:"#FB923C"})]}),(0,n.jsx)("filter",{id:"logoShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:(0,n.jsx)("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.25"})})]}),(0,n.jsx)("circle",{cx:"512",cy:"512",r:"512",fill:"url(#outerGrad)",filter:"url(#logoShadow)"}),(0,n.jsx)("circle",{cx:"512",cy:"512",r:"384",fill:"url(#innerGrad)"}),(0,n.jsx)("circle",{cx:"512",cy:"512",r:"192",fill:"white"})]})}),F=e=>{let{apiClient:t,backendStatus:s,connectionQuality:r,onTest:l}=e,[c,i]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(t&&"function"==typeof t.getMetrics){let e=()=>{try{u(t.getMetrics())}catch(e){console.warn("Error getting metrics:",e)}};e();let s=setInterval(e,5e3);return()=>clearInterval(s)}},[t]);let m=async()=>{i(!0);try{l&&"function"==typeof l&&await l()}catch(e){console.warn("Test connection error:",e)}finally{i(!1)}};return(0,n.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsxs)("span",{className:"text-xs font-medium flex items-center gap-1 ".concat((()=>{switch(s){case"connected":switch(r){case"excellent":default:return"text-green-600";case"good":return"text-green-500";case"fair":return"text-yellow-600";case"poor":return"text-orange-600"}case"degraded":return"text-orange-600";case"disconnected":return"text-red-600";case"testing":return"text-blue-600";default:return"text-gray-600"}})()),children:[(()=>{switch(s){case"connected":return(0,n.jsx)(b,{className:"w-3 h-3"});case"degraded":return(0,n.jsx)(j,{className:"w-3 h-3"});case"disconnected":return(0,n.jsx)(N,{className:"w-3 h-3"});case"testing":return(0,n.jsx)(o,{className:"w-3 h-3 animate-spin"});default:return(0,n.jsx)(v,{className:"w-3 h-3"})}})(),"connected"===s?"".concat({excellent:"\uD83D\uDFE2",good:"\uD83D\uDFE1",fair:"\uD83D\uDFE0",poor:"\uD83D\uDD34"}[r]||"\uD83D\uDFE2"," Connected"):"degraded"===s?"⚠️ Degraded":"disconnected"===s?"❌ Disconnected":"testing"===s?"\uD83D\uDD04 Testing...":"❓ Unknown"]}),(0,n.jsx)("button",{onClick:m,className:"text-xs text-blue-600 hover:text-blue-800 underline disabled:opacity-50",disabled:c||"testing"===s,children:c?"Testing...":"Test"})]}),d&&(0,n.jsxs)("div",{className:"text-xs text-slate-500 space-y-1",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Requests:"}),(0,n.jsx)("span",{children:d.totalRequests||0})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Success Rate:"}),(0,n.jsxs)("span",{className:(d.successRate||0)>=90?"text-green-600":(d.successRate||0)>=70?"text-yellow-600":"text-red-600",children:[d.successRate||0,"%"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Avg Response:"}),(0,n.jsxs)("span",{className:2e3>(d.avgResponseTime||0)?"text-green-600":5e3>(d.avgResponseTime||0)?"text-yellow-600":"text-red-600",children:[d.avgResponseTime||0,"ms"]})]})]})]})},L=e=>{let{progressLogs:t=[],isSyncing:s,onClear:r}=e,l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[t]),(0,n.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-slate-900 px-3 py-2 border-b border-slate-200 flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,n.jsx)(u,{size:14}),"Progress Log",s&&(0,n.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-xs text-slate-300",children:[t.length," entries"]}),t.length>0&&(0,n.jsx)("button",{onClick:r,className:"text-xs text-slate-300 hover:text-white px-2 py-1 rounded",children:"Clear"})]})]}),(0,n.jsx)("div",{className:"max-h-64 overflow-y-auto",children:0===t.length?(0,n.jsx)("div",{className:"p-4 text-center text-slate-500 text-sm",children:"No progress logs yet. Start a sync to see detailed progress."}):(0,n.jsxs)("div",{className:"p-2 space-y-1",children:[t.map((e,t)=>(0,n.jsx)("div",{className:"text-xs p-2 rounded border ".concat((e=>{switch(e){case"SUCCESS":return"text-green-700 bg-green-50 border-green-200";case"ERROR":return"text-red-700 bg-red-50 border-red-200";case"WARN":return"text-orange-700 bg-orange-50 border-orange-200";case"INFO":return"text-blue-700 bg-blue-50 border-blue-200";case"DEBUG":return"text-purple-700 bg-purple-50 border-purple-200";default:return"text-slate-700 bg-slate-50 border-slate-200"}})(e.level)),children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"flex-shrink-0",children:(e=>{switch(e){case"SUCCESS":return"✅";case"ERROR":return"❌";case"WARN":return"⚠️";case"INFO":return"ℹ️";case"DEBUG":return"\uD83D\uDD27";default:return"\uD83D\uDCDD"}})(e.level)}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"font-mono text-xs opacity-75 mb-1",children:e.timestamp}),(0,n.jsx)("div",{className:"break-words",children:e.message}),e.details&&(0,n.jsx)("div",{className:"mt-1 text-xs opacity-75 font-mono",children:e.details})]})]})},t)),(0,n.jsx)("div",{ref:l})]})})]})},U=e=>{var t,s,r;let{debugInfo:l,syncStatus:c,onEmergencyReset:i,isSyncing:d,backendVersion:m}=e,[h,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[p,y]=(0,a.useState)(null);return(0,a.useEffect)(()=>{d&&!g?f(Date.now()):!d&&g&&f(null)},[d,g]),(0,a.useEffect)(()=>{l&&y(Date.now())},[l]),(0,n.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-slate-900 px-3 py-2 border-b border-slate-200 flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,n.jsx)(u,{size:14}),"System Monitor",d&&(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(o,{size:12,className:"animate-spin text-blue-400"}),(0,n.jsx)("span",{className:"text-xs text-blue-400",children:(e=>{if(!e||e<0)return"0s";let t=Math.floor(e/60),s=e%60;return t>0?"".concat(t,":").concat(s.toString().padStart(2,"0")):"".concat(s,"s")})(g?Math.floor((Date.now()-g)/1e3):0)})]})]}),(0,n.jsx)("button",{onClick:()=>x(!h),className:"text-xs text-slate-300 hover:text-white",children:h?"Hide":"Show"})]}),(0,n.jsxs)("div",{className:"p-3 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Status:"}),(0,n.jsx)("span",{className:"font-mono",children:(()=>{if(!p)return"❓ No data";let e=Math.floor((Date.now()-p)/1e3);return e<3?"\uD83D\uDFE2 Live":e<10?"\uD83D\uDFE1 Recent":e<30?"\uD83D\uDFE0 Stale":"\uD83D\uDD34 Old"})()})]}),m&&(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Backend:"}),(0,n.jsx)("span",{className:"font-mono",children:m})]}),h&&l&&(0,n.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Files Found:"}),(0,n.jsx)("span",{className:"font-mono",children:(null==(t=l.sync_progress)?void 0:t.files_found)||0})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"API Calls:"}),(0,n.jsx)("span",{className:"font-mono",children:(null==(s=l.sync_progress)?void 0:s.api_calls)||0})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Operation:"}),(0,n.jsx)("span",{className:"font-mono text-blue-600",children:(null==(r=l.sync_progress)?void 0:r.current_operation)||"monitoring"})]})]}),(0,n.jsx)("div",{className:"pt-2 border-t border-slate-200",children:(0,n.jsxs)("button",{onClick:i,className:"w-full text-xs bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700 transition-colors flex items-center justify-center gap-1",children:[(0,n.jsx)(w,{size:12}),"Emergency Reset"]})})]})]})},G=e=>{let{syncStatus:t,onSyncNow:s,googleDriveUrl:a,isSyncing:r,isMonitoring:l,debugInfo:c}=e;return(0,n.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-4 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[(0,n.jsx)(x,{size:16}),"Google Drive Sync"]}),l&&(0,n.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]}),(0,n.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Status:"}),(0,n.jsx)("span",{className:"font-medium ".concat(r?"text-blue-600":"text-green-600"),children:r?"\uD83D\uDD04 Syncing...":"✅ Ready"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Files Found:"}),(0,n.jsx)("span",{className:"font-mono",children:c&&c.sync_progress&&c.sync_progress.files_found||0})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Last Sync:"}),(0,n.jsx)("span",{className:"font-mono",children:t&&t.last_sync?new Date(t.last_sync).toLocaleString():"Never"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Next Auto-Sync:"}),(0,n.jsx)("span",{className:"font-mono text-blue-600",children:(()=>{if(t&&t.next_auto_sync){let e=new Date(t.next_auto_sync)-new Date;if(e<=0)return"Soon";let s=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return s>0?"".concat(s,"h ").concat(n,"m"):"".concat(n,"m")}return"Unknown"})()})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)("button",{onClick:s,disabled:r,className:"flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-medium hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[(0,n.jsx)(m,{size:12,className:r?"animate-spin":""}),r?"Syncing...":"Sync Now"]}),(0,n.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-2 border border-slate-300 text-slate-700 rounded-lg text-xs hover:bg-slate-50 transition-colors flex items-center gap-1",children:[(0,n.jsx)(h,{size:12}),"Drive"]})]})]})},M=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log("Building file tree from paths:",e);let t={name:"root",children:{},files:[],isFolder:!0,path:"",fullPath:""};return Array.isArray(e)?(e.forEach(e=>{if(!e||"string"!=typeof e||""===e.trim())return void console.warn("Invalid file path skipped:",e);let s=e.split("/").filter(e=>""!==e.trim()),n=t,a="";s.forEach((t,r)=>{let l=r===s.length-1&&t.includes(".");if(a=a?"".concat(a,"/").concat(t):t,l){var c;n.files.push({name:t,path:a,fullPath:e,isFile:!0,extension:(null==(c=t.split(".").pop())?void 0:c.toLowerCase())||""})}else n.children[t]||(n.children[t]={name:t,children:{},files:[],isFolder:!0,path:a,fullPath:a}),n=n.children[t]})}),console.log("Built file tree:",t)):console.error("filePaths is not an array:",e),t},q=e=>{if(!e)return(0,n.jsx)(S,{className:"h-4 w-4 text-slate-500"});switch(e){case"pdf":return(0,n.jsx)(D,{className:"h-4 w-4 text-red-500"});case"doc":case"docx":return(0,n.jsx)(D,{className:"h-4 w-4 text-blue-500"});case"txt":return(0,n.jsx)(D,{className:"h-4 w-4 text-gray-500"});case"jpg":case"jpeg":case"png":case"gif":case"webp":return(0,n.jsx)(R,{className:"h-4 w-4 text-green-500"});case"zip":case"rar":case"7z":return(0,n.jsx)(E,{className:"h-4 w-4 text-purple-500"});case"js":case"py":case"html":case"css":case"json":return(0,n.jsx)(C,{className:"h-4 w-4 text-orange-500"});case"xlsx":case"xls":case"csv":return(0,n.jsx)(D,{className:"h-4 w-4 text-green-600"});default:return(0,n.jsx)(S,{className:"h-4 w-4 text-slate-500"})}},B=e=>{if(!e||!e.files)return 0;let t=e.files.length;return e.children&&Object.values(e.children).forEach(e=>{t+=B(e)}),t},z=e=>{let{filePaths:t=[],selectedDocs:s=[],onToggleDocSelection:r,onSelectAll:l}=e,[c,o]=(0,a.useState)(new Set),i=M(t);(0,a.useEffect)(()=>{Object.keys(i.children).length>0&&o(new Set(Object.keys(i.children)))},[t]);let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=c.has(e.path),l=B(e);return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer hover:bg-slate-100 text-sm",style:{paddingLeft:"".concat(16*t+8,"px")},onClick:()=>{var t;return t=e.path,void o(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},children:[a?(0,n.jsx)(y,{size:14,className:"text-slate-500"}):(0,n.jsx)(p,{size:14,className:"text-slate-500"}),a?(0,n.jsx)(f,{size:16,className:"text-yellow-600"}):(0,n.jsx)(g,{size:16,className:"text-yellow-600"}),(0,n.jsx)("span",{className:"flex-1 text-slate-700",children:e.name}),(0,n.jsxs)("span",{className:"text-xs text-slate-500",children:["(",l,")"]})]}),a&&(0,n.jsxs)("div",{children:[Object.values(e.children).map(e=>d(e,t+1)),e.files.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer hover:bg-slate-100 text-sm",style:{paddingLeft:"".concat((t+1)*16+24,"px")},onClick:()=>r(e.fullPath),children:[(0,n.jsx)("input",{type:"checkbox",checked:s.includes(e.fullPath),onChange:()=>r(e.fullPath),className:"rounded"}),q(e.extension),(0,n.jsx)("span",{className:"flex-1 text-slate-700 text-xs",children:e.name})]},e.fullPath))]})]},e.path)};return(0,n.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-slate-900 px-3 py-2 border-b border-slate-200 flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Knowledge Base"}),(0,n.jsx)("button",{onClick:l,className:"text-xs text-slate-300 hover:text-white",children:"Select All"})]}),(0,n.jsx)("div",{className:"max-h-96 overflow-y-auto p-2",children:Object.keys(i.children).length>0||i.files.length>0?(0,n.jsxs)("div",{className:"space-y-1",children:[Object.values(i.children).map(e=>d(e)),i.files.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 rounded cursor-pointer hover:bg-slate-100 text-sm",onClick:()=>r(e.fullPath),children:[(0,n.jsx)("input",{type:"checkbox",checked:s.includes(e.fullPath),onChange:()=>r(e.fullPath),className:"rounded"}),q(e.extension),(0,n.jsx)("span",{className:"flex-1 text-slate-700 text-xs",children:e.name})]},e.fullPath))]}):(0,n.jsx)("div",{className:"p-4 text-center text-slate-500 text-sm",children:'No documents available. Click "Sync Now" to load documents from Google Drive.'})})]})};class H extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){return this.state.hasError?(0,n.jsxs)("div",{className:"p-4 bg-red-100 border border-red-300 text-red-800 rounded-lg text-sm",children:[(0,n.jsx)("h3",{className:"font-semibold mb-1",children:"Debug Panel Error"}),(0,n.jsx)("p",{className:"text-xs",children:"Component failed to render. Check console for details."}),(0,n.jsx)("button",{onClick:()=>this.setState({hasError:!1}),className:"mt-2 text-xs underline",children:"Try Again"})]}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1}}}let Q=e=>{let{apiClient:t,availableDocs:s,selectedDocs:a,onToggleDocSelection:r,onSelectAll:l,syncStatus:c,onSyncNow:o,googleDriveUrl:i,apiError:u,isSyncing:m,debugInfo:h,onEmergencyReset:x,backendStatus:g,connectionQuality:f,onTestConnection:p,isMonitoring:y,backendVersion:b,progressLogs:j,onClearProgressLogs:N,addProgressLog:v}=e;return(0,n.jsxs)("aside",{className:"w-full lg:w-1/3 xl:w-1/4 bg-slate-50 border-r border-slate-200 p-4 flex flex-col space-y-4 overflow-hidden",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-2",children:[(0,n.jsx)(A,{}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"Clair Enhanced"})]}),(0,n.jsx)("p",{className:"text-sm text-slate-600 mb-1 font-bold",children:"随时守护您财富的智能专家"}),(0,n.jsx)("p",{className:"text-xs text-slate-500 font-medium",children:"明智财富 - Production Edition"}),(0,n.jsx)(F,{apiClient:t,backendStatus:g,connectionQuality:f,onTest:p})]}),(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(H,{children:(0,n.jsx)(U,{debugInfo:h,syncStatus:c,onEmergencyReset:x,isSyncing:m,backendVersion:b})})}),(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(L,{progressLogs:j,isSyncing:m,onClear:N})}),(0,n.jsxs)("div",{className:"flex-shrink-0",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-slate-700 mb-3",children:"Document Management"}),(0,n.jsx)(G,{syncStatus:c,onSyncNow:o,googleDriveUrl:i,isSyncing:m,isMonitoring:y,debugInfo:h,addProgressLog:v,apiClient:t}),u&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-red-100 border border-red-300 text-red-800 rounded-lg text-sm",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(d,{size:16,className:"flex-shrink-0 mt-0.5"}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("p",{className:"break-words",children:u})})]})})]}),(0,n.jsx)("div",{className:"flex-1 flex flex-col min-h-0",children:(0,n.jsx)(z,{filePaths:s,selectedDocs:a,onToggleDocSelection:r,onSelectAll:l})})]})},W=e=>{let{messages:t,isSending:s,inputQuery:a,onInputChange:r,onSendMessage:d,chatEndRef:u,selectedDocsCount:m,onFeedback:h}=e;return(0,n.jsxs)("main",{className:"flex-1 flex flex-col bg-white",children:[(0,n.jsx)("div",{className:"flex-1 p-6 overflow-y-auto",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-start gap-4 ".concat("user"===e.role?"justify-end":""),children:["ai"===e.role&&(0,n.jsx)("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-md",children:(0,n.jsx)(l,{className:"text-white",size:20})}),(0,n.jsxs)("div",{className:"max-w-lg p-4 rounded-xl ".concat("user"===e.role?"bg-blue-600 text-white":e.isError?"bg-red-100 text-red-800 border border-red-200":"bg-slate-100 text-slate-800"),children:[(0,n.jsx)("div",{className:"whitespace-pre-wrap",children:(e=>{if(!e||"string"!=typeof e)return e;let t=/(https?:\/\/[^\s\)]+)/g;return e.split(t).map((e,s)=>e.match(t)?(0,n.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline font-medium",children:e},s):e)})(e.content)}),e.metadata&&(0,n.jsxs)("div",{className:"mt-2 pt-2 border-t border-slate-200 text-xs text-slate-500",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("span",{children:["Documents: ",e.metadata.documentsUsed]}),(0,n.jsx)("span",{children:e.metadata.model||"gpt-4o"})]}),e.metadata.status&&"success"!==e.metadata.status&&(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("timeout"===e.metadata.status?"bg-orange-100 text-orange-800":"error"===e.metadata.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.metadata.status})})]}),"ai"===e.role&&!e.isError&&!e.feedbackGiven&&(0,n.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-slate-500",children:"Was this helpful?"}),(0,n.jsx)("button",{onClick:()=>h(t,"helpful"),className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",children:"\uD83D\uDC4D Yes"}),(0,n.jsx)("button",{onClick:()=>h(t,"not_helpful"),className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"\uD83D\uDC4E No"})]}),e.feedbackGiven&&(0,n.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["Thank you for your feedback! (",e.feedbackGiven,")"]})]}),"user"===e.role&&(0,n.jsx)("div",{className:"flex-shrink-0 h-10 w-10 bg-slate-200 rounded-full flex items-center justify-center",children:(0,n.jsx)(c,{className:"text-slate-600"})})]},t)),s&&(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-md",children:(0,n.jsx)(l,{className:"text-white",size:20})}),(0,n.jsx)("div",{className:"max-w-lg p-4 rounded-xl bg-slate-100 text-slate-800",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o,{className:"animate-spin",size:16}),(0,n.jsx)("span",{children:"Thinking with GPT-4o..."})]})})]}),(0,n.jsx)("div",{ref:u})]})}),(0,n.jsx)("div",{className:"bg-white border-t border-slate-200 p-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[m>0&&(0,n.jsxs)("div",{className:"mb-2 text-xs text-slate-500",children:["Searching in ",m," selected document",1!==m?"s":""]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("textarea",{value:a,onChange:r,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())},placeholder:"Ask Clair about your financial and insurance documents... (Enhanced with GPT-4o)",className:"w-full min-h-[48px] max-h-32 p-3 pr-12 border border-slate-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:1,disabled:s}),(0,n.jsx)("button",{onClick:d,disabled:s||!a.trim(),className:"absolute right-3 top-1/2 -translate-y-1/2 bg-gradient-to-br from-yellow-400 to-orange-500 text-white p-2 rounded-full hover:from-yellow-500 hover:to-orange-600 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all shadow-md",children:(0,n.jsx)(i,{size:16})})]})]})})]})};function V(){let e=(()=>{let[e,t]=(0,a.useState)([{role:"ai",content:"Hello! I'm Clair Enhanced ".concat(O,", your AI financial advisor powered by GPT-4o with comprehensive debugging and real-time monitoring. Current time: ").concat(k()," (").concat((()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return"UTC"}})(),"). I can help you understand your insurance policies, financial documents, and provide personalized financial guidance. Please sync your Google Drive folder to get started, then ask me any questions about your documents.")}]),[s,n]=(0,a.useState)(""),[r,l]=(0,a.useState)(!1),[c,o]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),[h,x]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[p,y]=(0,a.useState)(null),[b,j]=(0,a.useState)("unknown"),[N,v]=(0,a.useState)("unknown"),[w,S]=(0,a.useState)(!1),[D,R]=(0,a.useState)(null),[C,E]=(0,a.useState)([]),[T,I]=(0,a.useState)(!1),P=(0,a.useRef)(null),_=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={timestamp:k(),level:e,message:t,details:s};E(e=>[...e,n].slice(-50)),console.log("[".concat(e,"] ").concat(k(),": ").concat(t).concat(s?" - ".concat(s):""))};return{messages:e,setMessages:t,inputQuery:s,setInputQuery:n,isSending:r,setIsSending:l,availableDocs:c,setAvailableDocs:o,selectedDocs:i,setSelectedDocs:d,apiError:u,setApiError:m,syncStatus:h,setSyncStatus:x,isSyncing:g,setIsSyncing:f,debugInfo:p,setDebugInfo:y,backendStatus:b,setBackendStatus:j,connectionQuality:N,setConnectionQuality:v,isMonitoring:w,setIsMonitoring:S,backendVersion:D,setBackendVersion:R,progressLogs:C,setProgressLogs:E,isInitialized:T,setIsInitialized:I,chatEndRef:P,GOOGLE_DRIVE_URL:"https://drive.google.com/drive/folders/1pMiyyfk8hEoVVSsxMmRmobe6dmdm5sjI",addProgressLog:_,clearProgressLogs:()=>{E([]),_("INFO","Progress logs cleared")}}})(),t=(e=>{let{setBackendStatus:t,setConnectionQuality:s,setBackendVersion:n,addProgressLog:r}=e;return{testBackendConnection:(0,a.useCallback)(async()=>{try{t("testing");let e=Date.now();r("INFO","Testing backend connection...");let a=await _.healthCheck(),l=Date.now()-e;if(a&&a.version&&n(a.version),a&&"healthy"===a.status){t("connected");let e="excellent";l>=1e3&&(e="good"),l>=3e3&&(e="fair"),l>=5e3&&(e="poor"),s(e),r("SUCCESS","Backend connection successful (".concat(l,"ms)"),"Quality: ".concat(e,", Version: ").concat(a.version||"unknown")),console.log("✅ Backend connection successful (".concat(l,"ms)"))}else t("degraded"),s("poor"),r("WARN","Backend returned degraded status",JSON.stringify(a)),console.log("⚠️ Backend returned degraded status")}catch(e){t("disconnected"),s("failed"),r("ERROR","Backend connection failed",e.message),console.log("❌ Backend connection failed:",e.message)}},[t,s,n,r])}})(e),s=(e=>{let{setApiError:t,setIsSyncing:s,clearProgressLogs:n,addProgressLog:r,GOOGLE_DRIVE_URL:l}=e,c=(0,a.useCallback)(()=>{let e=0,t=0,n=0,a=0,l="",c=Date.now(),o=Date.now();r("INFO","Starting enhanced sync monitoring...","Monitoring every 3 seconds with stuck detection");let i=async()=>{try{e++,Date.now(),r("DEBUG","Monitor check #".concat(e),"Checking sync status and debug info...");let[d,u]=await Promise.all([_.getSyncStatus(),_.getDebugInfo()]);Date.now();let m=Math.floor((Date.now()-c)/1e3);if(d){if(!1===d.is_syncing){s(!1),r("SUCCESS","✅ Sync completed successfully after ".concat(m,"s"),"Final status: ".concat(JSON.stringify(d))),console.log("✅ Sync completed successfully");return}d.current_operation!==l&&(l=d.current_operation,o=Date.now(),t=0,r("INFO","Sync operation: ".concat(d.current_operation),"Progress: ".concat(d.files_processed||0,"/").concat(d.total_files||"?"," files")))}if(u&&u.sync_progress){let e=u.sync_progress,s=e.files_found||0,l=e.api_calls||0;s!==n||l!==a?(n=s,a=l,o=Date.now(),t=0,r("INFO","\uD83D\uDCCA Progress update","Files: ".concat(s,", API calls: ").concat(l,", Operation: ").concat(e.current_operation||"unknown"))):t++}let h=Date.now()-o;h>3e4&&r("WARN","⚠️ No sync progress detected for ".concat(Math.floor(h/1e3),"s"),"Sync may be stuck or processing large files"),e<120?setTimeout(i,3e3):(r("WARN","\uD83D\uDD04 Sync monitoring timeout reached","Stopped monitoring after 10 minutes"),s(!1))}catch(t){r("WARN","Monitor check #".concat(e," failed"),t.message),console.log("Monitor check #".concat(e," failed:"),t.message),e<120?setTimeout(i,5e3):s(!1)}};setTimeout(i,3e3)},[s,r]);return{handleSyncNow:(0,a.useCallback)(async()=>{try{t(""),s(!0),n(),r("INFO","\uD83D\uDE80 Starting enhanced sync...","Preparing to sync Google Drive folder"),console.log("\uD83D\uDE80 Starting enhanced sync..."),r("DEBUG","Testing backend health before sync...");let e=await _.healthCheck();if(!e||"healthy"!==e.status)throw Error("Backend health check failed: ".concat(e?e.status:"no response"));r("SUCCESS","Backend health check passed","Status: ".concat(e.status)),r("INFO","Testing Google Drive folder access...","Folder ID: ".concat(l.split("/").pop())),r("INFO","Initiating sync request...","Sending POST to /sync_drive");let a=Date.now(),o=await _.syncDrive(),i=Date.now()-a;if(r("SUCCESS","Sync request completed in ".concat(i,"ms"),"Response: ".concat(JSON.stringify(o))),console.log("\uD83D\uDCE1 Enhanced sync response:",o),o&&"error"===o.status)throw Error(o.message||"Sync failed to start");o&&("started"===o.status||"in_progress"===o.status)?(r("SUCCESS","Sync request accepted","Status: ".concat(o.status)),c()):(r("WARN","Unexpected sync response","Status: ".concat(o?o.status:"no response",", Message: ").concat(o?o.message:"none")),s(!1))}catch(n){console.error("❌ Enhanced sync error:",n),s(!1);let e="Sync failed";n.message.includes("timed out")?(e="Sync request timed out. The server may be processing large files. Monitoring will continue automatically.",r("ERROR","Sync request timed out","Server may be processing large files or Google Drive access issues")):n.message.includes("Failed to fetch")?(e="Failed to connect to backend. Please check server status.",r("ERROR","Failed to connect to backend","Network connection issue or server down")):n.message.includes("HTTP 503")?(e="Backend service temporarily unavailable. Please try again in a moment.",r("ERROR","Backend service unavailable","HTTP 503 - Service temporarily unavailable")):n.message.includes("HTTP 401")?(e="Google Drive access denied. Please check authentication.",r("ERROR","Google Drive access denied","HTTP 401 - Authentication issue")):n.message.includes("HTTP 403")?(e="Google Drive folder access forbidden. Please check permissions.",r("ERROR","Google Drive folder access forbidden","HTTP 403 - Permission denied")):(e="Sync failed: ".concat(n.message),r("ERROR","Sync failed to start",n.message)),t(e)}},[t,s,n,r,l,c]),monitorSyncProgressEnhanced:c}})(e),r=(e=>{let{messages:t,setMessages:s,setIsSending:n,selectedDocs:r,addProgressLog:l}=e;return{sendMessage:(0,a.useCallback)(async e=>{if(!e.trim())return;n(!0);let t={role:"user",content:e.trim()};s(e=>[...e,t]);try{let t;l("INFO","Processing question...",'Query: "'.concat(e.trim().substring(0,100)).concat(e.trim().length>100?"...":"",'"')),console.log("\uD83E\uDD16 Sending question:",e.trim());let n=Date.now(),a=await _.askQuestion(e.trim(),r),c=Date.now()-n;l("SUCCESS","Question processed in ".concat(c,"ms"),"Documents used: ".concat(r.length,", Model: ").concat(a&&a.model||"gpt-4o")),t=a&&a.answer?a.answer:a&&"string"==typeof a?a:"I received your question but got an unexpected response format. Please try again.",console.log("\uD83E\uDD16 AI Response received:",t),s(e=>[...e,{role:"ai",content:t,metadata:{timestamp:new Date().toISOString(),documentsUsed:r.length,model:a&&a.model||"gpt-4o",status:a&&a.status||"success",contextUsed:a&&a.context_used||!1,documentsSearched:a&&a.documents_searched||0}}])}catch(t){let e="I'm having trouble connecting. Please try again.";t.message.includes("timed out")?(e="The request timed out. Please try a simpler question or check your connection.",l("WARN","Question processing timed out",t.message)):t.message.includes("HTTP 503")?(e="I'm experiencing technical difficulties. Please try again in a moment.",l("ERROR","Service temporarily unavailable","HTTP 503 error")):t.message.includes("HTTP 408")?(e="Request timeout. Please try again with a shorter question.",l("WARN","Request timeout","HTTP 408 error")):t.message.includes("HTTP 500")?(e="Server error. The development team has been notified. Please try again later.",l("ERROR","Internal server error","HTTP 500 error")):l("ERROR","Question processing failed",t.message),s(t=>[...t,{role:"ai",content:e,isError:!0}]),console.error("Enhanced message error:",t)}finally{n(!1)}},[n,s,r,l]),handleFeedback:(0,a.useCallback)(async(e,n)=>{let a=t[e];if(!a||"ai"!==a.role)return;let r=e>0?t[e-1]:null;if(r&&"user"===r.role)try{await _.submitFeedback({query:r.content,response:a.content,feedback_type:n,documents_used:a.metadata&&a.metadata.documentsUsed||0,model:a.metadata&&a.metadata.model||"gpt-4o",context_used:a.metadata&&a.metadata.contextUsed||!1}),l("INFO","Feedback submitted: ".concat(n),"User feedback recorded"),s(t=>t.map((t,s)=>s===e?{...t,feedbackGiven:n}:t))}catch(e){l("WARN","Failed to send feedback",e.message),console.error("Failed to send feedback:",e)}},[t,s,l])}})(e),l=(e=>{let{setSyncStatus:t,setDebugInfo:s,setAvailableDocs:n,setSelectedDocs:r,addProgressLog:l}=e,c=(0,a.useCallback)(async()=>{try{let e=await _.getSyncStatus();return t(e),e}catch(e){return console.log("Failed to fetch sync status:",e.message),null}},[t]),o=(0,a.useCallback)(async()=>{try{let e=await _.getDebugInfo();return s(e),e}catch(e){return console.log("Failed to fetch debug info:",e.message),null}},[s]);return{fetchSyncStatus:c,fetchDebugInfo:o,loadDocuments:(0,a.useCallback)(async()=>{try{l("INFO","Loading indexed documents...","Fetching Vertex AI indexed files from backend");let e=Date.now(),t=await _.listIndexedFiles(),s=Date.now()-e,a=[];if(Array.isArray(t)?a=t:t&&Array.isArray(t.files)&&(a=t.files,console.log("\uD83D\uDCCA Vertex AI Index Status: ".concat(t.total_indexed," documents indexed, source: ").concat(t.source))),!a||!(a.length>0))return l("WARN","No indexed documents found","No documents are currently indexed in Vertex AI"),n([]),r([]),[];{n(a);let e=a.filter(e=>e&&e.includes(".")&&!e.endsWith("/"));return r(e),l("SUCCESS","Loaded ".concat(a.length," indexed documents in ").concat(s,"ms"),"Auto-selected ".concat(e.length," files for search from Vertex AI")),console.log("✅ Loaded ".concat(a.length," indexed documents from Vertex AI")),a}}catch(e){return e.message.includes("timed out")?l("ERROR","Document loading timed out","Request took too long to complete"):e.message.includes("HTTP 503")?l("ERROR","Service temporarily unavailable","HTTP 503 error"):l("ERROR","Failed to load documents",e.message),console.error("❌ Failed to load documents:",e.message),n([]),r([]),[]}},[n,r,l]),handleEmergencyReset:(0,a.useCallback)(async()=>{try{l("WARN","Emergency reset initiated","Clearing all data and resetting system");let e=await _.emergencyReset();return console.log("✅ Emergency reset successful:",e),t(null),s(null),n([]),r([]),l("SUCCESS","Emergency reset completed","All systems reset successfully"),e}catch(e){throw l("ERROR","Emergency reset failed",e.message),console.error("❌ Emergency reset failed:",e),e}},[t,s,n,r,l])}})(e),c={...t,...s,...r,...l},{isInitialized:i,setIsInitialized:d,isMonitoring:u,setIsMonitoring:m,isSyncing:h,availableDocs:x,selectedDocs:g,setSelectedDocs:f,messages:p,chatEndRef:y,addProgressLog:b}=e,{testBackendConnection:j,fetchSyncStatus:N,fetchDebugInfo:v,loadDocuments:w,handleSyncNow:S}=c;(0,a.useEffect)(()=>{i||(b("INFO","\uD83D\uDE80 Initializing Enhanced RAG Clair System ".concat(O),"Build date: ".concat("2025-07-31T00:00:00Z")),console.log("\uD83D\uDE80 Initializing Enhanced RAG Clair System..."),(async()=>{try{await j(),b("INFO","\uD83D\uDCCB Step 1: Loading indexed documents from Vertex AI","Checking what documents are already available for search");let e=await w();await Promise.all([N(),v()]),e&&e.length>0?(b("SUCCESS","✅ Found ".concat(e.length," indexed documents"),"Documents ready for search"),b("INFO","\uD83D\uDD04 Step 2: Checking Google Drive for updates","Running background sync to detect new documents"),setTimeout(()=>{S().catch(e=>{console.log("Background sync failed:",e.message),b("WARN","Background sync check failed","Documents remain available for search")})},2e3)):(b("WARN","⚠️ No indexed documents found","Starting initial sync with Google Drive"),setTimeout(()=>{S().catch(e=>{console.log("Initial sync failed:",e.message),b("ERROR","Initial sync failed","Please check Google Drive configuration")})},1e3)),m(!0),d(!0),b("SUCCESS","\uD83C\uDFAF App initialization completed","Ready to answer questions")}catch(e){b("ERROR","❌ App initialization failed",e.message),console.error("❌ App initialization failed:",e),d(!0)}})())},[i,d,m,b,j,w,N,v,S]),(0,a.useEffect)(()=>{if(!u||!i)return;let e=setInterval(()=>{N().catch(e=>console.log("Sync status poll failed:",e))},h?2e3:I.POLLING.SYNC_STATUS),t=setInterval(()=>{v().catch(e=>console.log("Debug info poll failed:",e))},I.POLLING.DEBUG_INFO),s=setInterval(()=>{j().catch(e=>console.log("Connection test failed:",e))},I.POLLING.CONNECTION);return()=>{clearInterval(e),clearInterval(t),clearInterval(s)}},[u,i,h,N,v,j]),(0,a.useEffect)(()=>{if(x.length>0&&0===g.length){let e=x.filter(e=>e&&e.includes(".")&&!e.endsWith("/"));f(e),b("INFO","Auto-selected ".concat(e.length," documents"),"All available documents selected for search")}},[x,g.length,f,b]),(0,a.useEffect)(()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})},[p,y]);let D=async()=>{try{await l.handleEmergencyReset(),e.setIsSyncing(!1),e.setApiError(""),setTimeout(()=>{e.addProgressLog("INFO","Refreshing system status...","Getting updated system information"),l.fetchSyncStatus(),l.fetchDebugInfo(),t.testBackendConnection()},1e3)}catch(t){e.addProgressLog("ERROR","Emergency reset failed",t.message),console.error("❌ Emergency reset failed:",t)}};return e.isInitialized?(0,n.jsxs)("div",{className:"h-screen w-screen bg-slate-100 flex flex-col lg:flex-row font-sans",children:[(0,n.jsx)(Q,{apiClient:_,availableDocs:e.availableDocs,selectedDocs:e.selectedDocs,onToggleDocSelection:t=>e.setSelectedDocs(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]),onSelectAll:()=>{let t=e.availableDocs.filter(e=>e&&e.includes(".")&&!e.endsWith("/")),s=e.selectedDocs.length===t.length?[]:t;e.setSelectedDocs(s),e.addProgressLog("INFO",0===s.length?"Deselected all documents":"Selected ".concat(s.length," documents"),"Document selection updated")},syncStatus:e.syncStatus,onSyncNow:s.handleSyncNow,googleDriveUrl:e.GOOGLE_DRIVE_URL,apiError:e.apiError,isSyncing:e.isSyncing,debugInfo:e.debugInfo,onEmergencyReset:D,backendStatus:e.backendStatus,connectionQuality:e.connectionQuality,onTestConnection:t.testBackendConnection,isMonitoring:e.isMonitoring,backendVersion:e.backendVersion,progressLogs:e.progressLogs,onClearProgressLogs:e.clearProgressLogs,addProgressLog:e.addProgressLog}),(0,n.jsx)(W,{messages:e.messages,isSending:e.isSending,inputQuery:e.inputQuery,onInputChange:t=>e.setInputQuery(t.target.value),onSendMessage:()=>{if(!e.inputQuery.trim()||e.isSending)return;let t=e.inputQuery.trim();e.setInputQuery(""),r.sendMessage(t)},chatEndRef:e.chatEndRef,selectedDocsCount:e.selectedDocs.length,onFeedback:r.handleFeedback})]}):(0,n.jsx)("div",{className:"h-screen w-screen bg-slate-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(o,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),(0,n.jsx)("p",{className:"text-slate-600",children:"Initializing Enhanced RAG System..."}),(0,n.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:O})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=1638)),_N_E=e.O()}]);